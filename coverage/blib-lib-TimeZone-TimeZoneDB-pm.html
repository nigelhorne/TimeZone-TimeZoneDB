<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="https://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::Cover Version 1.51
Devel::Cover is copyright 2001-2025, Paul Johnson (paul@pjcj.net)
Devel::Cover is free. It is licensed under the same terms as Perl itself.
The latest version of Devel::Cover should be available from my homepage:
https://pjcj.net
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <meta http-equiv="Content-Language" content="en-us"></meta>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <title>File Coverage: blib/lib/TimeZone/TimeZoneDB.pm</title>
</head>
<body>
<h1>File Coverage</h1>
<table>
<tr><td class="h" align="right">File:</td><td align="left">blib/lib/TimeZone/TimeZoneDB.pm</td></tr>
<tr><td class="h" align="right">Coverage:</td><td align="left" class="c1">76.6%</td></tr>
</table>
<div><br/></div>
<table>
<tr><th>line</th><th>stmt</th><th>bran</th><th>cond</th><th>sub</th><th>time</th><th>code</th></tr>
<tr><td class="h">1</td><td></td><td></td><td></td><td></td><td></td><td class="s">package TimeZone::TimeZoneDB;</td></tr>
<tr><td class="h">2</td><td colspan="6"></td></tr><tr><td class="h">3</td><td><div class="c3">4</div><div class="c3">4</div><div class="c3">4</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TimeZone-TimeZoneDB-pm--subroutine.html#L3">4</a></div></td><td><div>330885</div><div>4</div><div>56</div></td><td class="s">use strict;</td></tr>
<tr><td class="h">4</td><td><div class="c3">4</div><div class="c3">4</div><div class="c3">4</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TimeZone-TimeZoneDB-pm--subroutine.html#L4">4</a></div></td><td><div>4</div><div>4</div><div>65</div></td><td class="s">use warnings;</td></tr>
<tr><td class="h">5</td><td colspan="6"></td></tr><tr><td class="h">6</td><td><div class="c3">4</div><div class="c3">4</div><div class="c3">4</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TimeZone-TimeZoneDB-pm--subroutine.html#L6">4</a></div></td><td><div>7</div><div>3</div><div>83</div></td><td class="s">use Carp;</td></tr>
<tr><td class="h">7</td><td><div class="c3">4</div><div class="c3">4</div><div class="c3">4</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TimeZone-TimeZoneDB-pm--subroutine.html#L7">4</a></div></td><td><div>829</div><div>97825</div><div>59</div></td><td class="s">use CHI;</td></tr>
<tr><td class="h">8</td><td><div class="c3">4</div><div class="c3">4</div><div class="c3">4</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TimeZone-TimeZoneDB-pm--subroutine.html#L8">4</a></div></td><td><div>12</div><div>1</div><div>128</div></td><td class="s">use JSON::MaybeXS;</td></tr>
<tr><td class="h">9</td><td><div class="c3">4</div><div class="c3">4</div><div class="c3">4</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TimeZone-TimeZoneDB-pm--subroutine.html#L9">4</a></div></td><td><div>985</div><div>63585</div><div>61</div></td><td class="s">use LWP::UserAgent;</td></tr>
<tr><td class="h">10</td><td><div class="c3">4</div><div class="c3">4</div><div class="c3">4</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TimeZone-TimeZoneDB-pm--subroutine.html#L10">4</a></div></td><td><div>764</div><div>150451</div><div>66</div></td><td class="s">use Object::Configure;</td></tr>
<tr><td class="h">11</td><td><div class="c3">4</div><div class="c3">4</div><div class="c3">4</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TimeZone-TimeZoneDB-pm--subroutine.html#L11">4</a></div></td><td><div>16</div><div>24</div><div>73</div></td><td class="s">use Params::Get 0.13;</td></tr>
<tr><td class="h">12</td><td><div class="c3">4</div><div class="c3">4</div><div class="c3">4</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TimeZone-TimeZoneDB-pm--subroutine.html#L12">4</a></div></td><td><div>7</div><div>27</div><div>42</div></td><td class="s">use Params::Validate::Strict 0.10;</td></tr>
<tr><td class="h">13</td><td><div class="c3">4</div><div class="c3">4</div><div class="c3">4</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TimeZone-TimeZoneDB-pm--subroutine.html#L13">4</a></div></td><td><div>8</div><div>3</div><div>36</div></td><td class="s">use Return::Set;</td></tr>
<tr><td class="h">14</td><td><div class="c3">4</div><div class="c3">4</div><div class="c3">4</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TimeZone-TimeZoneDB-pm--subroutine.html#L14">4</a></div></td><td><div>5</div><div>4</div><div>37</div></td><td class="s">use Scalar::Util;</td></tr>
<tr><td class="h">15</td><td><div class="c3">4</div><div class="c3">4</div><div class="c3">4</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TimeZone-TimeZoneDB-pm--subroutine.html#L15">4</a></div></td><td><div>6</div><div>3</div><div>18</div></td><td class="s">use Time::HiRes;</td></tr>
<tr><td class="h">16</td><td><div class="c3">4</div><div class="c3">4</div><div class="c3">4</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TimeZone-TimeZoneDB-pm--subroutine.html#L16">4</a></div></td><td><div>153</div><div>5</div><div>1473</div></td><td class="s">use URI;</td></tr>
<tr><td class="h">17</td><td colspan="6"></td></tr><tr><td class="h">18 - 26</td><td colspan="5"></td><td class="s"><pre>=head1 NAME

TimeZone::TimeZoneDB - Interface to L&lt;https://timezonedb.com&gt; for looking up Timezone data

=head1 VERSION

Version 0.03

=cut</pre></td></tr>
<tr><td class="h">27</td><td colspan="6"></td></tr><tr><td class="h">28</td><td></td><td></td><td></td><td></td><td></td><td class="s">our $VERSION = &#39;0.03&#39;;</td></tr>
<tr><td class="h">29</td><td colspan="6"></td></tr><tr><td class="h">30 - 116</td><td colspan="5"></td><td class="s"><pre>=head1 SYNOPSIS

&nbsp;&nbsp;&nbsp;&nbsp;use TimeZone::TimeZoneDB;

&nbsp;&nbsp;&nbsp;&nbsp;my $tzdb = TimeZone::TimeZoneDB-&gt;new(key =&gt; &#39;XXXXXXXX&#39;);
&nbsp;&nbsp;&nbsp;&nbsp;my $tz = $tzdb-&gt;get_time_zone({ latitude =&gt; 0.1, longitude =&gt; 0.2 });

=head1 DESCRIPTION

The C&lt;TimeZone::TimeZoneDB&gt; Perl module provides an interface to the L&lt;https://timezonedb.com&gt; API,
enabling users to retrieve timezone data based on geographic coordinates.
It supports configurable HTTP user agents, allowing for proxy settings and request throttling.
The module includes robust error handling, ensuring proper validation of input parameters and secure API interactions.
JSON responses are safely parsed with error handling to prevent crashes.
Designed for flexibility,
it allows users to override default configurations while maintaining a lightweight and efficient structure for querying timezone information.

=over 4

=item * Caching

Identical requests are cached (using L&lt;CHI&gt; or a user-supplied caching object),
reducing the number of HTTP requests to the API and speeding up repeated queries.

This module leverages L&lt;CHI&gt; for caching geocoding responses.
When a geocode request is made,
a cache key is constructed from the request.
If a cached response exists,
it is returned immediately,
avoiding unnecessary API calls.

=item * Rate-Limiting

A minimum interval between successive API calls can be enforced to ensure that the API is not overwhelmed and to comply with any request throttling requirements.

Rate-limiting is implemented using L&lt;Time::HiRes&gt;.
A minimum interval between API
calls can be specified via the C&lt;min_interval&gt; parameter in the constructor.
Before making an API call,
the module checks how much time has elapsed since the
last request and,
if necessary,
sleeps for the remaining time.

=back

=head1 METHODS

=head2 new

&nbsp;&nbsp;&nbsp;&nbsp;my $tzdb = TimeZone::TimeZoneDB-&gt;new();
&nbsp;&nbsp;&nbsp;&nbsp;my $ua = LWP::UserAgent::Throttled-&gt;new();
&nbsp;&nbsp;&nbsp;&nbsp;$ua-&gt;env_proxy(1);
&nbsp;&nbsp;&nbsp;&nbsp;$tzdb = TimeZone::TimeZoneDB-&gt;new(ua =&gt; $ua, key =&gt; &#39;XXXXX&#39;);

&nbsp;&nbsp;&nbsp;&nbsp;my $tz = $tzdb-&gt;get_time_zone({ latitude =&gt; 51.34, longitude =&gt; 1.42 })-&gt;{&#39;zoneName&#39;};
&nbsp;&nbsp;&nbsp;&nbsp;print &quot;Ramsgate&#39;s time zone is $tz.\n&quot;;

Creates a new instance. Acceptable options include:

=over 4

=item * C&lt;ua&gt;

An object to use for HTTP requests.
If not provided, a default user agent is created.

=item * C&lt;host&gt;

The API host endpoint.
Defaults to L&lt;https://api.timezonedb.com&gt;

=item * C&lt;cache&gt;

A caching object.
If not provided,
an in-memory cache is created with a default expiration of one day.

=item * C&lt;min_interval&gt;

Minimum number of seconds to wait between API requests.
Defaults to C&lt;0&gt; (no delay).
Use this option to enforce rate-limiting.

=back

=cut</pre></td></tr>
<tr><td class="h">117</td><td colspan="6"></td></tr><tr><td class="h">118</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub new</td></tr>
<tr><td class="h">119</td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">120</td><td><div class="c3">5</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TimeZone-TimeZoneDB-pm--subroutine.html#L120">5</a></div></td><td><div>217935</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $class = shift;</td></tr>
<tr><td class="h">121</td><td><div class="c3">5</div></td><td></td><td><div class="c3"><a href="blib-lib-TimeZone-TimeZoneDB-pm--condition.html#L121">100</a></div></td><td></td><td><div>35</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $params = Params::Get::get_params(undef, \@_) || {};</td></tr>
<tr><td class="h">122</td><td colspan="6"></td></tr><tr><td class="h">123</td><td><div class="c3">5</div></td><td><div class="c0" title="-/F"><a href="blib-lib-TimeZone-TimeZoneDB-pm--branch.html#L123">50</a></div><div class="c0" title="-/F"><a href="blib-lib-TimeZone-TimeZoneDB-pm--branch.html#L123">50</a></div></td><td></td><td></td><td><div>95</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!defined($class)) {</td></tr>
<tr><td class="h">124</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# TimeZone::TimeZoneDB::new() used rather than TimeZone::TimeZoneDB-&gt;new()</td></tr>
<tr><td class="h">125</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$class = __PACKAGE__;</td></tr>
<tr><td class="h">126</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif(Scalar::Util::blessed($class)) {</td></tr>
<tr><td class="h">127</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# If $class is an object, clone it with new arguments</td></tr>
<tr><td class="h">128</td><td><div class="c0">0</div><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return bless { %{$class}, %{$params} }, ref($class);</td></tr>
<tr><td class="h">129</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">130</td><td colspan="6"></td></tr><tr><td class="h">131</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td><div>19</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params = Object::Configure::configure($class, $params);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Reads in the runtime configuration settings</td></tr>
<tr><td class="h">132</td><td colspan="6"></td></tr><tr><td class="h">133</td><td><div class="c3">5</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TimeZone-TimeZoneDB-pm--branch.html#L133">100</a></div></td><td></td><td></td><td><div>50276</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $key = $params-&gt;{&#39;key&#39;} or Carp::croak(&quot;&#39;key&#39; argument is required&quot;);</td></tr>
<tr><td class="h">134</td><td colspan="6"></td></tr><tr><td class="h">135</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $ua = $params-&gt;{ua};</td></tr>
<tr><td class="h">136</td><td><div class="c3">4</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TimeZone-TimeZoneDB-pm--branch.html#L136">100</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!defined($ua)) {</td></tr>
<tr><td class="h">137</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ua = LWP::UserAgent-&gt;new(agent =&gt; __PACKAGE__ . &quot;/$VERSION&quot;);</td></tr>
<tr><td class="h">138</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>1266</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ua-&gt;default_header(accept_encoding =&gt; &#39;gzip,deflate&#39;);</td></tr>
<tr><td class="h">139</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">140</td><td><div class="c3">4</div></td><td></td><td><div class="c0"><a href="blib-lib-TimeZone-TimeZoneDB-pm--condition.html#L140">50</a></div></td><td></td><td><div>40</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $host = $params-&gt;{host} || &#39;api.timezonedb.com&#39;;</td></tr>
<tr><td class="h">141</td><td colspan="6"></td></tr><tr><td class="h">142</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Set up caching (default to an in-memory cache if none provided)</td></tr>
<tr><td class="h">143</td><td><div class="c3">4</div></td><td></td><td><div class="c0"><a href="blib-lib-TimeZone-TimeZoneDB-pm--condition.html#L143">67</a></div></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $cache = $params-&gt;{cache} || CHI-&gt;new(</td></tr>
<tr><td class="h">144</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;driver =&gt; &#39;Memory&#39;,</td></tr>
<tr><td class="h">145</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global =&gt; 0,</td></tr>
<tr><td class="h">146</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expires_in =&gt; &#39;1 day&#39;,</td></tr>
<tr><td class="h">147</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">148</td><td colspan="6"></td></tr><tr><td class="h">149</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Set up rate-limiting: minimum interval between requests (in seconds)</td></tr>
<tr><td class="h">150</td><td><div class="c3">4</div></td><td></td><td><div class="c3"><a href="blib-lib-TimeZone-TimeZoneDB-pm--condition.html#L150">100</a></div></td><td></td><td><div>44946</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $min_interval = $params-&gt;{min_interval} || 0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# default: no delay</td></tr>
<tr><td class="h">151</td><td colspan="6"></td></tr><tr><td class="h">152</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return bless {</td></tr>
<tr><td class="h">153</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key =&gt; $key,</td></tr>
<tr><td class="h">154</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;min_interval =&gt; $min_interval,</td></tr>
<tr><td class="h">155</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last_request =&gt; 0,&nbsp;&nbsp;&nbsp;# Initialize last_request timestamp</td></tr>
<tr><td class="h">156</td><td><div class="c3">4</div><div class="c3">4</div></td><td></td><td></td><td></td><td><div>8</div><div>23</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%{$params},</td></tr>
<tr><td class="h">157</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cache =&gt; $cache,</td></tr>
<tr><td class="h">158</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;host =&gt; $host,</td></tr>
<tr><td class="h">159</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ua =&gt; $ua,</td></tr>
<tr><td class="h">160</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}, $class;</td></tr>
<tr><td class="h">161</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">162</td><td colspan="6"></td></tr><tr><td class="h">163 - 192</td><td colspan="5"></td><td class="s"><pre>=head2 get_time_zone

Returns a hashref with at least one key (the zoneName)

&nbsp;&nbsp;&nbsp;&nbsp;use Geo::Location::Point;

&nbsp;&nbsp;&nbsp;&nbsp;my $ramsgate = Geo::Location::Point-&gt;new({ latitude =&gt; 51.34, longitude =&gt; 1.42 });
&nbsp;&nbsp;&nbsp;&nbsp;# Find Ramsgate&#39;s time zone
&nbsp;&nbsp;&nbsp;&nbsp;$tz = $tzdb-&gt;get_time_zone($ramsgate)-&gt;{&#39;zoneName&#39;}, &quot;\n&quot;;

=head3&nbsp;&nbsp;API SPECIFICATION

=head4&nbsp;&nbsp;INPUT

&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&#39;latitude&#39; =&gt; { type =&gt; &#39;number&#39;, min =&gt; -90, max =&gt; 90 },
&nbsp;&nbsp;&nbsp;&nbsp;&#39;longitude&#39; =&gt; { type =&gt; &#39;number&#39;, min =&gt; -180, max =&gt; 180 },
&nbsp;&nbsp;}

=head4&nbsp;&nbsp;OUTPUT

Argument error: croak
No matches found: undef

&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&#39;type&#39; =&gt; &#39;hashref&#39;,
&nbsp;&nbsp;&nbsp;&nbsp;&#39;min&#39; =&gt; 1
&nbsp;&nbsp;}

=cut</pre></td></tr>
<tr><td class="h">193</td><td colspan="6"></td></tr><tr><td class="h">194</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub get_time_zone</td></tr>
<tr><td class="h">195</td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">196</td><td><div class="c3">4</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-TimeZone-TimeZoneDB-pm--subroutine.html#L196">4</a></div></td><td><div>144</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">197</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $params;</td></tr>
<tr><td class="h">198</td><td colspan="6"></td></tr><tr><td class="h">199</td><td><div class="c3">4</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TimeZone-TimeZoneDB-pm--branch.html#L199">100</a></div></td><td><div class="c1"><a href="blib-lib-TimeZone-TimeZoneDB-pm--condition.html#L199">75</a></div></td><td></td><td><div>18</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if((@_ == 1) &amp;&amp; Scalar::Util::blessed($_[0]) &amp;&amp; $_[0]-&gt;can(&#39;latitude&#39;)) {</td></tr>
<tr><td class="h">200</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $location = $_[0];</td></tr>
<tr><td class="h">201</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params-&gt;{latitude} = $location-&gt;latitude();</td></tr>
<tr><td class="h">202</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>19</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params-&gt;{longitude} = $location-&gt;longitude();</td></tr>
<tr><td class="h">203</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">204</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params = Params::Get::get_params(undef, \@_);</td></tr>
<tr><td class="h">205</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">206</td><td colspan="6"></td></tr><tr><td class="h">207</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td><div>37</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params = Params::Validate::Strict::validate_strict(</td></tr>
<tr><td class="h">208</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;args =&gt; $params,</td></tr>
<tr><td class="h">209</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;schema =&gt; {</td></tr>
<tr><td class="h">210</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;latitude&#39; =&gt; { type =&gt; &#39;number&#39;, min =&gt; -90, max =&gt; 90 },</td></tr>
<tr><td class="h">211</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;longitude&#39; =&gt; { type =&gt; &#39;number&#39;, min =&gt; -180, max =&gt; 180 },</td></tr>
<tr><td class="h">212</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">213</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">214</td><td colspan="6"></td></tr><tr><td class="h">215</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>178</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $latitude = $params-&gt;{latitude};</td></tr>
<tr><td class="h">216</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>1</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $longitude = $params-&gt;{longitude};</td></tr>
<tr><td class="h">217</td><td colspan="6"></td></tr><tr><td class="h">218</td><td><div class="c3">3</div></td><td><div class="c0" title="-/F"><a href="blib-lib-TimeZone-TimeZoneDB-pm--branch.html#L218">50</a></div></td><td><div class="c0"><a href="blib-lib-TimeZone-TimeZoneDB-pm--condition.html#L218">33</a></div></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if((!defined($latitude)) || (!defined($longitude))) {</td></tr>
<tr><td class="h">219</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Carp::carp(&#39;Usage: get_time_zone(latitude =&gt; $latitude, longitude =&gt; $longitude)&#39;);</td></tr>
<tr><td class="h">220</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">221</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">222</td><td colspan="6"></td></tr><tr><td class="h">223</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $uri = URI-&gt;new(&quot;https://$self-&gt;{host}/v2.1/get-time-zone&quot;);</td></tr>
<tr><td class="h">224</td><td colspan="6"></td></tr><tr><td class="h">225</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Note - we have to pass in the key in the URL, as the API doesn&#39;t support the Authorization header</td></tr>
<tr><td class="h">226</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uri-&gt;query_form(</td></tr>
<tr><td class="h">227</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by =&gt; &#39;position&#39;,</td></tr>
<tr><td class="h">228</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lat =&gt; $latitude,</td></tr>
<tr><td class="h">229</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lng =&gt; $longitude,</td></tr>
<tr><td class="h">230</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;format =&gt; &#39;json&#39;,</td></tr>
<tr><td class="h">231</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>7552</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key =&gt; $self-&gt;{&#39;key&#39;}</td></tr>
<tr><td class="h">232</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">233</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>252</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $url = $uri-&gt;as_string();</td></tr>
<tr><td class="h">234</td><td colspan="6"></td></tr><tr><td class="h">235</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# # Set up HTTP headers</td></tr>
<tr><td class="h">236</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# my $req = HTTP::Request-&gt;new(GET =&gt; $url);</td></tr>
<tr><td class="h">237</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# $req-&gt;header(&#39;Authorization&#39; =&gt; &quot;Bearer $self-&gt;{key}&quot;);</td></tr>
<tr><td class="h">238</td><td colspan="6"></td></tr><tr><td class="h">239</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# $url =~ s/%2C/,/g;</td></tr>
<tr><td class="h">240</td><td colspan="6"></td></tr><tr><td class="h">241</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Create a cache key based on the location (might want to use a stronger hash function if needed)</td></tr>
<tr><td class="h">242</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Normalize the key so that 0.1 vs 0.1000000 use the same key</td></tr>
<tr><td class="h">243</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>20</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $cache_key = sprintf(&#39;tz:%.6f:%.6f&#39;, $latitude, $longitude);</td></tr>
<tr><td class="h">244</td><td><div class="c3">3</div></td><td><div class="c0" title="-/F"><a href="blib-lib-TimeZone-TimeZoneDB-pm--branch.html#L244">50</a></div></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(my $cached = $self-&gt;{cache}-&gt;get($cache_key)) {</td></tr>
<tr><td class="h">245</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $cached;</td></tr>
<tr><td class="h">246</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">247</td><td colspan="6"></td></tr><tr><td class="h">248</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Enforce rate-limiting: ensure at least min_interval seconds between requests</td></tr>
<tr><td class="h">249</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>181</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $now = time();</td></tr>
<tr><td class="h">250</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $elapsed = $now - $self-&gt;{last_request};</td></tr>
<tr><td class="h">251</td><td><div class="c3">3</div></td><td><div class="c3" title="T/F"><a href="blib-lib-TimeZone-TimeZoneDB-pm--branch.html#L251">100</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($elapsed &lt; $self-&gt;{min_interval}) {</td></tr>
<tr><td class="h">252</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>1000185</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time::HiRes::sleep($self-&gt;{min_interval} - $elapsed);</td></tr>
<tr><td class="h">253</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">254</td><td colspan="6"></td></tr><tr><td class="h">255</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>23</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $res = $self-&gt;{ua}-&gt;get($url);</td></tr>
<tr><td class="h">256</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# my $res = $self-&gt;{ua}-&gt;request($req);</td></tr>
<tr><td class="h">257</td><td colspan="6"></td></tr><tr><td class="h">258</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Update last_request timestamp</td></tr>
<tr><td class="h">259</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>194</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;{last_request} = time();</td></tr>
<tr><td class="h">260</td><td colspan="6"></td></tr><tr><td class="h">261</td><td><div class="c3">3</div></td><td><div class="c0" title="-/F"><a href="blib-lib-TimeZone-TimeZoneDB-pm--branch.html#L261">50</a></div></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($res-&gt;is_error()) {</td></tr>
<tr><td class="h">262</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Carp::croak(&quot;$url API returned error: &quot;, $res-&gt;status_line());</td></tr>
<tr><td class="h">263</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">264</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">265</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# $res-&gt;content_type(&#39;text/plain&#39;);&nbsp;&nbsp;# May be needed to decode correctly</td></tr>
<tr><td class="h">266</td><td colspan="6"></td></tr><tr><td class="h">267</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>19</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $rc;</td></tr>
<tr><td class="h">268</td><td><div class="c3">3</div><div class="c3">3</div></td><td></td><td></td><td></td><td><div>4</div><div>47</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eval { $rc = JSON::MaybeXS-&gt;new()-&gt;utf8()-&gt;decode($res-&gt;decoded_content()) };</td></tr>
<tr><td class="h">269</td><td><div class="c3">3</div></td><td><div class="c0" title="-/F"><a href="blib-lib-TimeZone-TimeZoneDB-pm--branch.html#L269">50</a></div></td><td></td><td></td><td><div>396</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($@) {</td></tr>
<tr><td class="h">270</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Carp::carp(&quot;Failed to parse JSON response: $@&quot;);</td></tr>
<tr><td class="h">271</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">272</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">273</td><td colspan="6"></td></tr><tr><td class="h">274</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Cache the result before returning it</td></tr>
<tr><td class="h">275</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>39</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;{&#39;cache&#39;}-&gt;set($cache_key, $rc);</td></tr>
<tr><td class="h">276</td><td colspan="6"></td></tr><tr><td class="h">277</td><td><div class="c3">3</div></td><td><div class="c0" title="-/F"><a href="blib-lib-TimeZone-TimeZoneDB-pm--branch.html#L277">50</a></div></td><td><div class="c0"><a href="blib-lib-TimeZone-TimeZoneDB-pm--condition.html#L277">25</a></div></td><td></td><td><div>745</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($rc &amp;&amp; defined($rc-&gt;{&#39;status&#39;}) &amp;&amp; ($rc-&gt;{&#39;status&#39;} ne &#39;OK&#39;)) {</td></tr>
<tr><td class="h">278</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="blib-lib-TimeZone-TimeZoneDB-pm--branch.html#L278">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(my $logger = $self-&gt;{&#39;logger&#39;}) {</td></tr>
<tr><td class="h">279</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$logger-&gt;warn(__PACKAGE__, &quot;: $url returns $rc-&gt;{status}&quot;);</td></tr>
<tr><td class="h">280</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">281</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">282</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">283</td><td colspan="6"></td></tr><tr><td class="h">284</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Assert output: a hashref with at least one key (the zoneName)</td></tr>
<tr><td class="h">285</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return Return::Set::set_return($rc, { &#39;type&#39; =&gt; &#39;hashref&#39;, &#39;min&#39; =&gt; 1 }); # No support for list context, yet</td></tr>
<tr><td class="h">286</td><td colspan="6"></td></tr><tr><td class="h">287</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# my @results = @{ $data || [] };</td></tr>
<tr><td class="h">288</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# wantarray ? @results : $results[0];</td></tr>
<tr><td class="h">289</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">290</td><td colspan="6"></td></tr><tr><td class="h">291 - 308</td><td colspan="5"></td><td class="s"><pre>=head2 ua

Accessor method to get and set UserAgent object used internally. You
can call I&lt;env_proxy&gt; for example, to get the proxy information from
environment variables:

&nbsp;&nbsp;&nbsp;&nbsp;$tzdb-&gt;ua()-&gt;env_proxy(1);

Free accounts are limited to one search a second,
so you can use L&lt;LWP::UserAgent::Throttled&gt; to keep within that limit.

&nbsp;&nbsp;&nbsp;&nbsp;use LWP::UserAgent::Throttled;

&nbsp;&nbsp;&nbsp;&nbsp;my $ua = LWP::UserAgent::Throttled-&gt;new();
&nbsp;&nbsp;&nbsp;&nbsp;$ua-&gt;throttle(&#39;timezonedb.com&#39; =&gt; 1);
&nbsp;&nbsp;&nbsp;&nbsp;$tzdb-&gt;ua($ua);

=cut</pre></td></tr>
<tr><td class="h">309</td><td colspan="6"></td></tr><tr><td class="h">310</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub ua {</td></tr>
<tr><td class="h">311</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="blib-lib-TimeZone-TimeZoneDB-pm--subroutine.html#L311">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">312</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="blib-lib-TimeZone-TimeZoneDB-pm--branch.html#L312">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (@_) {</td></tr>
<tr><td class="h">313</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;{ua} = shift;</td></tr>
<tr><td class="h">314</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">315</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;{ua};</td></tr>
<tr><td class="h">316</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">317</td><td colspan="6"></td></tr><tr><td class="h">318 - 347</td><td colspan="5"></td><td class="s"><pre>=head1 AUTHOR

Nigel Horne, C&lt;&lt; &lt;njh@bandsman.co.uk&gt; &gt;&gt;

This library is free software; you can redistribute it and/or modify
it under the same terms as Perl itself.

Lots of thanks to the folks at L&lt;https://timezonedb.com&gt;.

=head1 BUGS

This module is provided as-is without any warranty.

Please report any bugs or feature requests to C&lt;bug-timezone-timezonedb at rt.cpan.org&gt;,
or through the web interface at
L&lt;http://rt.cpan.org/NoAuth/ReportBug.html?Queue=TimeZone-TimeZoneDB&gt;.
I will be notified, and then you&#39;ll
automatically be notified of progress on your bug as I make changes.

=head1 SEE ALSO

TimezoneDB API: L&lt;https://timezonedb.com/api&gt;

=head1 LICENSE AND COPYRIGHT

Copyright 2023-2025 Nigel Horne.

This program is released under the following licence: GPL2

=cut</pre></td></tr>
<tr><td class="h">348</td><td colspan="6"></td></tr><tr><td class="h">349</td><td></td><td></td><td></td><td></td><td></td><td class="s">1;</td></tr>
</table>
</body>
</html>
